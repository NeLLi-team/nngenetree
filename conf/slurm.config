/*
 * SLURM Configuration
 * Settings for HPC cluster execution
 */

params {
    // Use production database
    blast_db = '/clusterfs/jgi/scratch/science/mgs/nelli/databases/nr/nr'
    blast_hits = 20
    closest_neighbors = 10

    // Resource configuration for SLURM
    resources {
        run_diamond_blastp {
            threads = 8
            mem_mb = 32000
            time = '2h'
        }
        align_sequences {
            threads = 8
            mem_mb = 16000
            time = '1h'
            disk_mb = 10000
        }
        build_tree {
            threads = 8
            mem_mb = 16000
            time = '1h'
        }
        extract_hits {
            threads = 1
            mem_mb = 8000
            time = '30m'
        }
    }
}

process {
    executor = 'slurm'
    queue = 'lr6'
    clusterOptions = '--qos=lr_normal --account=pc_jgieg'

    // SLURM-specific settings
    scratch = true

    // Error handling for cluster
    errorStrategy = { task.exitStatus in [140,143,137,104,134,139] ? 'retry' : 'finish' }
    maxRetries = 3
}

executor {
    name = 'slurm'
    queueSize = 50
    submitRateLimit = '10 sec'
}